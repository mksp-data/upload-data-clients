<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Upload de Arquivos</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 500px; margin: 40px auto; }
        h1 { font-size: 22px; }
        .box { border: 1px solid #ccc; padding: 20px; border-radius: 8px; }
        button { margin-top: 10px; padding: 8px 16px; cursor: pointer; }
        #status { margin-top: 15px; font-size: 14px; }
        .error { color: #b00020; }
        .success { color: #006400; }
    </style>
</head>
<body>
    <h1>Envio de arquivos</h1>
    <div class="box">
        <p id="clienteInfo"></p>
        <input type="file" id="fileInput">
        <br>
        <button onclick="upload()">Enviar</button>
        <p id="status"></p>
    </div>

    <script>
        // Mapeamento cliente -> URL SAS do container
        const clientes = {
            terranordeste: "https://mkspclientstorage.blob.core.windows.net/entrada-terranordeste?sp=rcl&st=2026-01-01T03:00:00Z&se=2050-01-01T03:00:00Z&spr=https&sv=2024-11-04&sr=c&sig=i2mXNOIGYwPtuz1hFtjw0V2lb3vfQ1tMtT5TUWsQqdE%3D"
            // cliente2: "https://...URL_SAS_DO_CONTAINER_DELES...",
            // cliente3: "https://...URL_SAS_DO_CONTAINER_DELES..."
        };

        const params = new URLSearchParams(window.location.search);
        const cliente = params.get("cliente");
        const sasUrl = clientes[cliente];

        const clienteInfo = document.getElementById("clienteInfo");
        const statusEl = document.getElementById("status");

        if (!cliente || !sasUrl) {
            clienteInfo.innerHTML = "Cliente inválido ou não configurado. Verifique o link.";
            clienteInfo.className = "error";
        } else {
            clienteInfo.innerHTML = "Cliente: <strong>" + cliente + "</strong>";
        }

        async function upload() {
            statusEl.className = "";
            statusEl.innerText = "";

            if (!sasUrl) {
                statusEl.innerText = "Configuração de cliente inválida.";
                statusEl.className = "error";
                return;
            }

            const fileInput = document.getElementById("fileInput");
            const file = fileInput.files[0];

            if (!file) {
                statusEl.innerText = "Selecione um arquivo antes de enviar.";
                statusEl.className = "error";
                return;
            }

            statusEl.innerText = "Enviando arquivo...";
            try {
                // A URL SAS aponta para o container; precisamos montar a URL do blob
                const baseUrlAndQuery = sasUrl.split("?");
                const baseUrl = baseUrlAndQuery[0];
                const query = baseUrlAndQuery[1];

                const uploadUrl = baseUrl + "/" + encodeURIComponent(file.name) + "?" + query;

                const response = await fetch(uploadUrl, {
                    method: "PUT",
                    headers: {
                        "x-ms-blob-type": "BlockBlob"
                    },
                    body: file
                });

                if (response.ok) {
                    statusEl.innerText = "Arquivo enviado com sucesso!";
                    statusEl.className = "success";
                    fileInput.value = "";
                } else {
                    const text = await response.text();
                    statusEl.innerText = "Erro ao enviar: " + response.status + " - " + text;
                    statusEl.className = "error";
                }
            } catch (err) {
                statusEl.innerText = "Erro: " + err.message;
                statusEl.className = "error";
            }
        }
    </script>
</body>
</html>